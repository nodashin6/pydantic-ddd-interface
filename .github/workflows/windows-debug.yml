name: Windows Debug Test

on:
  push:
    branches: [ feature/#8-fix-windows-workflow ]

defaults:
  run:
    shell: bash

jobs:
  windows-debug:
    runs-on: windows-latest
    timeout-minutes: 45
    
    steps:
    - name: 🔽 Checkout code
      uses: actions/checkout@v4
    
    - name: 🐍 Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.12"
    
    - name: 🔧 Update pip and install Poetry
      run: |
        python -m pip install --upgrade pip
        pip install poetry==1.8.3
        poetry --version
        echo "Poetry installation completed"
    
    - name: 🛠️ Configure Poetry for Windows
      run: |
        poetry config virtualenvs.create true
        poetry config virtualenvs.in-project true
        poetry config --list
    
    - name: 📋 Debug environment
      run: |
        echo "=== Python Information ==="
        python --version
        python -c "import sys; print('Python executable:', sys.executable)"
        echo ""
        echo "=== Poetry Information ==="
        poetry --version
        poetry env info
        echo ""
        echo "=== Current Directory ==="
        pwd
        echo ""
        echo "=== Files in current directory ==="
        ls -la
    
    - name: 🔧 Install dependencies with verbose output
      run: |
        echo "Installing dependencies..."
        poetry install --no-interaction --verbose
        echo "Installation completed"
    
    - name: 🧪 Run tests with detailed output
      run: |
        echo "Running tests..."
        poetry run python -m pytest -v --tb=short
        echo "Tests completed"
    
    - name: 📦 Build package with debug
      run: |
        echo "Building package..."
        poetry build --verbose
        echo ""
        echo "=== Build artifacts ==="
        find dist -type f
    
    - name: 📊 Final summary
      run: |
        echo "🎉 Windows debug test completed successfully!"
        echo "✅ Poetry: OK"
        echo "✅ Dependencies: OK" 
        echo "✅ Tests: OK"
        echo "✅ Build: OK"
        echo "✅ Imports: OK"
